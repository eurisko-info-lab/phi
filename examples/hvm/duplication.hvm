// =============================================================================
// HVM4 Example: Duplication (Optimal Sharing)
// =============================================================================
// Demonstrates how HVM duplicates values only when needed, and shares
// computation results automatically.

// ---------------------------------------------------------------------------
// Duplicating a function
// ---------------------------------------------------------------------------
// When we duplicate a lambda and apply copies to different args,
// shared work inside is computed only ONCE.

@main =
  ! f &A= λx.(x + x);  // Duplicate this function
  ((f₀ 10), (f₁ 20))   // Apply to 10 and 20

// ---------------------------------------------------------------------------
// Reduction trace:
// ---------------------------------------------------------------------------
//
// ! f &A= λx.(x + x); ((f₀ 10), (f₁ 20))
// -------------------------------------- DUP-LAM (duplicate the lambda)
// ! b &A= (&A{$x0, $x1} + &A{$x0, $x1});
// ((λ$x0.b₀ 10), (λ$x1.b₁ 20))
// -------------------------------------- APP-LAM (substitute)
// ! b &A= (&A{10, 20} + &A{10, 20});
// (b₀, b₁)
// -------------------------------------- OP2-SUP, DUP-SUP (shared!)
// ! b &A= &A{(10 + 10), (20 + 20)};
// (b₀, b₁)
// -------------------------------------- OP2-NUM
// ! b &A= &A{20, 40};
// (b₀, b₁)
// -------------------------------------- DUP-SUP (extract)
// (20, 40)

